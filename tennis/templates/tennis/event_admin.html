{# tennis/templates/tennis/event_admin.html #}
{% extends "tennis/base.html" %}
{% load static %}

{% block title %}{{ event.title }} - å¹¹äº‹ç”¨{% endblock %}

{% block extra_head %}
<script src="{% static 'tennis/admin.js' %}" defer></script>
{% endblock %}

{% block content %}
<h2>å¹¹äº‹ç”¨ç”»é¢ï¼š{{ event.title }}</h2>
<p>{{ event.date }} @ {{ event.place }}</p>

<h3>å‡ºå¸­è€…ãƒªã‚¹ãƒˆ</h3>

{% if participants %}
<table id="participants-table"
       class="participants-table"
       data-update-participation-url="{% url 'tennis:update_participation_flag' %}">
    <colgroup>
        <col style="width: 40px;">
        <col style="width: 150px;">
        <col>
    </colgroup>
    <thead>
        <tr>
            <th></th>
            <th>åå‰</th>
            <th>è©¦åˆå‚åŠ </th>
        </tr>
    </thead>
    <tbody>
    {% for p in participants %}
    <tr>
        <td class="participant-index">{{ forloop.counter }}</td>
        <td>
            <div class="tb-player-card-sm">
                {{ p.name }}
            </div>
        </td>
        <td class="checkbox-cell">
            <input type="checkbox" class="match-flag-checkbox"
                   data-participant-id="{{ p.id }}"
                   {% if p.participates_match %}checked{% endif %}>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

{% else %}
<table id="participants-table"
       class="participants-table">
    <colgroup>
        <col style="width: 40px;">
        <col style="width: 150px;">
        <col>
    </colgroup>
    <thead>
        <tr>
            <th></th>
            <th>åå‰</th>
            <th>è©¦åˆå‚åŠ </th>
        </tr>
    </thead>
    <tbody>
    {% for i in "1234" %}
    <tr>
        <td class="participant-index">{{ forloop.counter }}</td>
        <td><div class="tb-player-card-sm">&nbsp;</div></td>
        <td class="checkbox-cell"><input type="checkbox" disabled></td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<p style="margin-top:4px; font-size:0.85rem; color:#666;">
    ã¾ã å‚åŠ è€…ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ¡ãƒ³ãƒãƒ¼ãƒšãƒ¼ã‚¸ã«ã¦å‚åŠ è€…ã‚’å‹Ÿé›†ã—ã¦ãã ã•ã„ã€‚
</p>
{% endif %}

<h3>å¯¾æˆ¦è¡¨ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆï¼‰</h3>

<div class="match-settings-bar">
    <div class="match-pill-group">
        <button type="button"
                id="pill-game-type"
                class="settings-pill game-type-pill settings-trigger
                       {% if game_type == 'singles' %}pill-singles{% else %}pill-doubles{% endif %}">
            {% if game_type == "singles" %}ã‚·ãƒ³ã‚°ãƒ«ã‚¹{% else %}ãƒ€ãƒ–ãƒ«ã‚¹{% endif %}
        </button>

        <button type="button"
                id="pill-num-courts"
                class="settings-pill settings-trigger">
            {{ num_courts }} é¢
        </button>

        <button type="button"
                id="pill-match-count"
                class="settings-pill settings-trigger">
            {{ match_count }} äºº
        </button>

        <button type="button"
                id="pill-num-rounds"
                class="settings-pill settings-trigger">
            {{ num_rounds }} ãƒ©ã‚¦ãƒ³ãƒ‰
        </button>
    </div>

    <button type="button"
            id="publish-pill"
            class="settings-pill publish-pill
                   {% if publish_state in 'no_schedule published' %}pill-disabled{% endif %}"
            data-publish-state="{{ publish_state }}"
            onclick="publishSchedule()"
            {% if publish_state in 'no_schedule published' %}disabled{% endif %}>
        {% if publish_state == 'published' %}
            å…¬é–‹æ¸ˆã¿
        {% elif publish_state == 'changed' %}
            å†å…¬é–‹
        {% else %}
            ğŸ“¢ å¯¾æˆ¦è¡¨ã‚’å…¬é–‹
        {% endif %}
    </button>
</div>

<script
  id="current-schedule-json"
  type="application/json"
  data-event-id="{{ event.id }}"
  data-publish-url="{% url 'tennis:publish_schedule' %}"
>
  {{ schedule_json|default:"null" }}
</script>

{% if publish_state == 'changed' %}
<div id="publish-notice" class="publish-notice">
    å¯¾æˆ¦è¡¨ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚ã“ã®å¤‰æ›´ã‚’å‚åŠ è€…ãƒšãƒ¼ã‚¸ã¸é©ç”¨ã™ã‚‹å ´åˆã¯ã€Œå†å…¬é–‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
</div>
{% endif %}

<div id="match-settings-modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-content">
        <button type="button" class="modal-close" id="close-settings-modal">Ã—</button>
        <h3>æ¡ä»¶ã‚’å¤‰æ›´ã™ã‚‹</h3>

        <form method="post"
            id="match-settings-form"
            class="modal-form"
            data-generate-url="{% url 'tennis:ajax_generate_schedule' event.id %}">
            {% csrf_token %}
            <input type="hidden" name="generate_schedule" value="1">

            <div class="field-group">
                <div class="toggle-row">
                    <button type="button"
                            class="toggle-btn {% if game_type == 'singles' %}active{% endif %}"
                            data-game-type="singles">
                        ã‚·ãƒ³ã‚°ãƒ«ã‚¹
                    </button>
                    <button type="button"
                            class="toggle-btn {% if game_type != 'singles' %}active{% endif %}"
                            data-game-type="doubles">
                        ãƒ€ãƒ–ãƒ«ã‚¹
                    </button>
                </div>
                <input type="hidden" name="game_type" id="id_game_type"
                       value="{{ game_type|default:'doubles' }}">
            </div>

            <div class="field-group field-group-count">
                <label>äººæ•°</label>
                <p class="count-pill modal-number">
                    {{ match_count }}
                </p>
            </div>

            <div class="field-group">
                <label>é¢æ•°</label>
                <div class="stepper-row">
                    <button type="button" class="stepper-btn" data-target="num_courts" data-step="-1">ï¼</button>
                    <input type="number"
                        id="id_num_courts"
                        name="num_courts"
                        class="modal-number"
                        min="1" max="8"
                        value="{{ num_courts }}">
                    <button type="button" class="stepper-btn" data-target="num_courts" data-step="1">ï¼‹</button>
                </div>
            </div>

            <div class="field-group">
                <label>ãƒ©ã‚¦ãƒ³ãƒ‰æ•°</label>
                <div class="stepper-row">
                    <button type="button" class="stepper-btn" data-target="num_rounds" data-step="-1">ï¼</button>
                    <input type="number"
                        id="id_num_rounds"
                        name="num_rounds"
                        class="modal-number"
                        min="1" max="20"
                        value="{{ num_rounds }}">
                    <button type="button" class="stepper-btn" data-target="num_rounds" data-step="1">ï¼‹</button>
                </div>
            </div>

            <div class="modal-actions">
                <button type="submit" class="btn btn-primary">
                    æ¡ä»¶ã‚’å¤‰æ›´ã™ã‚‹
                </button>
            </div>
        </form>
    </div>
</div>

<div id="schedule-area">
    {% include "tennis/_schedule_block.html" %}
</div>

<div id="stats-area">
    {% include "tennis/_stats_block.html" %}
</div>

{% endblock %}
